@using Cimon.Auth
@using System.Security.Claims
<RadzenStack Orientation="Orientation.Horizontal">
    <RadzenProfileMenu>
        <Template>
            <RadzenLabel>@_name</RadzenLabel>
            <RadzenGravatar Style="width: 22px;height: 22px;" Email="@_email"></RadzenGravatar>
        </Template>
        <ChildContent>
            <RadzenProfileMenuItem Text="Logout" Path="/auth/logout" Icon="logout"></RadzenProfileMenuItem>
        </ChildContent>
    </RadzenProfileMenu>
    <MentionsInfoComponent />
</RadzenStack>
<style>
    .rz-menu.rz-profile-menu{
        padding: 0;
    }
</style>
@code {
    [CascadingParameter]
    private Task<AuthenticationState> AuthenticationState { get; set; } = null!;

    private string? _email;
    private string? _name;
    
    protected override async Task OnInitializedAsync() {
        await base.OnInitializedAsync();
        var state = await AuthenticationState;
        if (state.User.Identity != null) {
            _name = state.User.Identity.Name;
            _email = state.User.Claims.First(x=>x.Type == ClaimTypes.Email).Value;
        }
    }
}
