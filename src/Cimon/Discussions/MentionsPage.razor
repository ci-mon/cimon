@page "/mentions"
@using Cimon.Data.Discussions
@using Cimon.Data.Users
@inherits ReactiveComponent
@inject MentionsService MentionsService
@inject ICurrentUserAccessor UserAccessor
@inject NavigationManager NavigationManager
<PageTitle>Mentions</PageTitle>
<RadzenCard>
    @if (_mentions.IsEmpty) {
        <RadzenText TextStyle="TextStyle.H2" Text="All good..." />
    } else {
        <RadzenStack Orientation="Orientation.Vertical" JustifyContent="JustifyContent.Start">
            <RadzenText Text="@StatusText" />
            @foreach (var mention in _mentions.Value) {
                <RadzenStack Orientation="Orientation.Horizontal">
                    <RadzenButton Text="@mention.BuildId" Click="() => GoToDiscussion(mention.BuildId)"/>
                </RadzenStack>
            }
        </RadzenStack>
    }
</RadzenCard>
@code {
    private ReactiveValue<IReadOnlyCollection<MentionInfo>?> _mentions = null!;
    private string StatusText => $"You was mentioned in {_mentions.Value?.Count ?? 0} builds";
    protected override async Task OnInitializedAsync() {
        await base.OnInitializedAsync();
        var user = await UserAccessor.Current;
        _mentions = Subscribe(MentionsService.GetMentions(user));
    }

    private void GoToDiscussion(string buildId) {
        NavigationManager.NavigateTo($"buildDiscussion/{buildId}");
    }

}
